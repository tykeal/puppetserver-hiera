---

role: role::gerrit

# The resource collection tag to be used by our nginx system(s)
nginx::exporttag: 'home-lab'

# nginx::export_vhost: false

# # nginx SSL information
# nginx::ssl_cert_name: 'bardicgrove'
# nginx::ssl_cert_chain: 'startcom_sub_class2'
# nginx::ssl_dhparam: 'gerrit2kdhparam'
#
gerrit::gitweb_package_name: 'git2u-gitweb'

# what mysql db do we want to pick us up
gerrit::db_tag: 'bardichome-db'
gerrit::gerrit_version: '2.15.18'

gerrit::override_options:
  auth:
    type: 'LDAP'
  cache:
    directory: 'cache'
  cache.web_sessions:
    maxAge: '1mon'
  database:
    type: 'MYSQL'
    hostname: 'mysql.home.bardicgrove.org'
    database: 'gerrit'
    username: 'gerrit'
  gc:
    startTime: 'Sun 03:15'
    interval: '2 day'
  gerrit:
    basePath: '/srv/gerrit'
    canonicalWebUrl: 'http://gerrit-lab.home.bardicgrove.org/r'
    serverId: 'f88e09eb-1e32-4923-8041-0dc5a1bfd25b'
  gitweb:
    cgi: '/var/www/git/gitweb.cgi'
  httpd:
    listenUrl: 'proxy-http://*:8080/r'
    maxQueued: '200'
  ldap:
    server: 'ldap://ldap.home.bardicgrove.org'
    accountBase: 'ou=Users,dc=bardicgrove,dc=org'
    accountPattern: '(uid=${username})'
    accountFullName: '${cn}'
    groupBase: 'ou=Groups,dc=bardicgrove,dc=org'
    groupMemberPattern: '(member=${dn})'
  sendemail:
    smtpServer: 'localhost'
    from: '${user} (Code Review) <gerrit@gerrit.home.bardicgrove.org>'
  sshd:
    listenAddress: '*:29418'
  user:
    email: 'gerrit@gerrit.home.bardicgrove.org'
  receive:
    enableSignedPush: 'true'

# gerrit::third_party_plugins:
#   delete-project:
# yamllint disable rule:line-length
#     plugin_source: 'https://gerrit-ci.gerritforge.com/view/Plugins-stable-2.13/job/plugin-delete-project-stable-2.13/lastSuccessfulBuild/artifact/buck-out/gen/plugins/delete-project/delete-project.jar'
#   importer:
#     plugin_source: 'https://gerrit-ci.gerritforge.com/view/Plugins-stable-2.13/job/plugin-importer-stable-2.13/lastSuccessfulBuild/artifact/buck-out/gen/plugins/importer/importer.jar'
# yamllint enable

gerrit::override_secure_options:
  database:
    # yamllint disable rule:line-length
    password: ENC[GPG,hQEMA8SoCjunVJylAQf/fdcz5JSkygMuG2aplYlSrmHDAfVHcO7pAyY9Gqa/9x4f0kcmPfviDoY32AWjtmlAyMNJ6am6/BLA1uZw07ObUwBUpIpnT+x5TZCBIehRReBzgwVI7IdtGkQN6lUz8kEJN+kCQTnAchK6lE8DsY0R4uyXovAp2ecfEO5Ep2BA6pS3DFemrOxGq0RUyDQQ65kKXBRgVwKZEsIwsqcRcj72lcEOY1h+fU1yApgQdb4DGA9IHHaO4msUWZeaIerAvwIXRMf7KJdDqZDcaN+iZb12SU3z27Ia4RYBHcjOxnzxVl74ZjYWhAp3U0Dc7NROOei2flNsHjezNNOOgTTRS3vWcYUCDAOVosJoWKQPaQEP/0CbQpJgatFXkrE6hljgeb0fqY3ytH7KZpy1Ewo1GHZXIlnbavhhDrYSBOJJz5zWvf3/q7nFHrYPp0gXGyJ8Dr+tOsFJ8l1jPWYr/8A7pI/FXXrgbVOsVac+ZOisfgVY/ye7vrq3r+uBnTKJUjUmCQr5BVvJ8uLEgezQxGPWh+onlLleXtDKmNkBBzeMpPtXiv1DkAqJ7YS51qOa7niriYnusEW7DSD4gslVdst5cbwJ6TyQBZxto5HL93AurS8R0+oXAyORezJMjvJ1bfCLfkK5WUaaYi/qaGLAq2UXF6bDq8Gm7qIcImvnoLAt3+HTcBPebW1OA/l81m4osiYjnWnEQ6yLwvvFx2EB7KIEJ2gUDKJ72PnCnDcFJ5gf1fO6N3Dijvn6qMaBIcghVTu4vyftUa/55ka2dBegFXbdEO2yYXXSvVof65p4ycmHHUxtKuc7v7/BEZ17CStBxV0wMQ6butAgepeTJQrMdx0NDT5r2HSFCh+3a3rjPJkhynOH/gl2OtzgUzA0gH2h8v282AERfAvS2WAAhjJQYlxSwFTnjXtk4bvRCyGzOT6pT4rR/VF6C5EMjVh61FD5jpfCV+wx6g/H+ebE0nDE1wtTk8486JqHWBLmbRMkg0ttiQdV7NHr9jg3UpPGlz3CatPPBl+LSw+6lYznUWH+zHyRrFXT0lsBA+LwEZg3s9jJfNNoNAJ7NjEq5vpg6DS6rtoIxksoHMb35XPDUeCA74X2v27PIGizvTVuBUr3w+MP1cz/2M1+LLSqLOgk/x+IkLlKSgrNoqSHjB2IF9hkuPL2]
    # yamllint enable

# push ssh known hosts
ssh::known_hosts:
  'github.com':
    name: 'github.com'
    host_aliases:
      - 192.30.252.131
    ensure: present
    type: 'ssh-rsa'
    # yamllint disable rule:line-length
    key: 'AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pLlVDBfOLX9QUsyCOV0wzfjIJNlGEYsdlLJizHhbn2mUjvSAHQqZETYP81eFzLQNnPHt4EVVUh7VfDESU84KezmD5QlWpXLmvU31/yMf+Se8xhHTvKSCZIFImWwoG6mbUoWf9nzpIoaSjB+weqqUUmpaaasXVal72J+UX2B+2RPW3RcT0eOzQgqlJL3RKrTJvdsjE3JEAvGq3lGHSZXy28G3skua2SmVi/w4yCE6gbODqnTWlg7+wC604ydGXA8VJiS5ap43JXiUFFAaQ'
    # yamllint enable

# push ssh user configuration
ssh::users_client_options:
  gerrit:
    user_home_dir: '/opt/gerrit'
    options:
      'Host github.com':
        User: git

# vim: ts=2 sw=2 sts=2 et :
